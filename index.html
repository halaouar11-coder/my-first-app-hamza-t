<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تطبيق حساب النقاط – 38 جولة (عرض فقط)</title>
<style>
:root{
  --bg:#0f1420; --panel:#141c2b; --muted:#99a2b3; --text:#e8eefc; --accent:#4f7cff;
  --ok:#1fbf75; --danger:#ff5d5d; --sticky:#0d1320;
  --border:#22304a; --input:#0b1120;
}
*{box-sizing:border-box}
html,body{background:var(--bg);color:var(--text);margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, "Noto Naskh Arabic", "Segoe UI Variable","Helvetica Neue", Arial, sans-serif}
.container{max-width:1200px;margin:auto;padding:18px}
header{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.logo{width:56px;height:56px;border-radius:14px;object-fit:cover;border:2px solid var(--border)}
h1{font-size:clamp(20px,3.2vw,28px);margin:0 0 6px 0}
.sub{color:var(--muted);font-size:13px}
.bar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
button{
  background:var(--panel);border:1px solid var(--border);color:var(--text);
  padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:600
}
button:hover{border-color:#3a5279}
.accent{background:var(--accent);border-color:transparent}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin:14px 0}
.card{
  background:var(--panel);border:1px solid var(--border);border-radius:16px;
  padding:12px 14px;min-width:180px
}
.card .name{color:var(--muted);font-size:13px}
.card .score{font-size:24px;font-weight:800;line-height:1.2;margin-bottom:8px}
.chips{display:flex;flex-direction:column;gap:4px}
.chip{font-size:13px;padding:4px 6px;border-radius:8px;border:1px solid var(--border);display:flex;justify-content:space-between}
.chip.active{background:#1f3d2b;color:var(--ok);font-weight:600}
.chip.inactive{background:#2a2d3a;color:var(--danger)}
.wrap{display:grid;grid-template-columns:1fr 300px;gap:14px}
@media (max-width:980px){.wrap{grid-template-columns:1fr}}
.table-wrap{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:auto}
table{border-collapse:separate;border-spacing:0;width:max(780px,100%);font-size:15px}
thead th{position:sticky;top:0;background:var(--sticky);z-index:5}
th,td{border-bottom:1px solid var(--border);padding:10px 8px;text-align:center;white-space:nowrap}
tbody tr:nth-child(odd){background:rgba(255,255,255,0.01)}
tbody tr:hover{background:rgba(255,255,255,0.03)}
.round-col{position:sticky;right:0;background:var(--sticky);z-index:4;border-left:1px solid var(--border);font-weight:700}
.sum-col{font-weight:700;color:#b9d3ff}
.aside{display:flex;flex-direction:column;gap:14px}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
.panel h3{margin:4px 0 8px 0;font-size:16px}
ol.rank{margin:0;padding:0 18px}
.rank li{margin:6px 0;padding:6px 8px;border-radius:10px;background:#0f1522;border:1px solid var(--border);display:flex;justify-content:space-between}
.muted{color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <header>
    <img src="logo.png" alt="Fantasy Logo" class="logo" />
    <div>
      <h1>تطبيق حساب النقاط – 38 جولة (عرض فقط)</h1>
      <div class="sub">الزوار يشاهدون النتائج فقط، بدون إمكانية تعديل.</div>
    </div>
    <div class="bar">
      <button class="accent" id="exportCsv">تصدير CSV</button>
    </div>
  </header>

  <!-- بطاقات المجموع مع الخصائص -->
  <section class="grid" id="totalsGrid"></section>

  <div class="wrap">
    <div class="table-wrap">
      <table id="pointsTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
        <tfoot id="tableFoot"></tfoot>
      </table>
    </div>

    <aside class="aside">
      <div class="panel">
        <h3>الترتيب الحالي</h3>
        <ol class="rank" id="ranking"></ol>
      </div>
      <div class="panel">
        <h3>ترتيب الجولة الحالية</h3>
        <ol class="rank" id="roundRanking"></ol>
      </div>
    </aside>
  </div>
</div>

<script>
(() => {
  const players = ["Hamza","Abderzakk","ABDEJALIL","Hicham","Othman","Brahim"];
  const ROUNDS = 38;

  // النقاط للجولات
  const data = [
    [72,60,72,73,39,76], [49,45,47,52,78,65],
    [70,54,68,57,61,56], [76,66,76,67,72,61],
    [36,62,52,40,56,55],
    [54,60,52,43,51,72],
    [74,80,63,57,69,67],
    [55,65,85,64,73,68],
    [44,38,43,39,41,54],
    [81,77,82,77,96,68],
    [47,57,43,39,60,52],
     [30,33,55,33,47,33],
     [58,29,51,45,42,62],
     [72,49,86,97,58,79],
     [44,49,32,77,45,54],
     [23,24,25,26,27,29],

  // الخصائص لكل لاعب (true = مفعلة ✅, false = غير مفعلة ❌)
  const chips =
    Hamza:     {bench:false,  triple:true,  freehit:false},
    Abderzakk: {bench:true, triple:false,   freehit:false},
    ABDEJALIL: {bench:true, triple:true,  freehit:false},
    Hicham:    {bench:true, triple:false,  freehit:false },
    Othman:    {bench:true,  triple:false,  freehit:false},
    Brahim:    {bench:true, triple:false,  freehit:false}
  };

  const el = q=>document.querySelector(q);
  const head = el("#tableHead"), body = el("#tableBody"), foot = el("#tableFoot");
  const totalsGrid = el("#totalsGrid"), ranking = el("#ranking"), roundRankingEl = el("#roundRanking");

  function buildUI(){
    // بطاقات مع الخصائص
    totalsGrid.innerHTML = players.map(p=>{
      const c = chips[p];
      return `
      <div class="card" data-player="${p}">
        <div class="name">${p}</div>
        <div class="score" id="total-${p}">0</div>
        <div class="chips">
          <span class="chip ${c.bench?'active':'inactive'}">Bench Boost ${c.bench?'✅':'❌'}</span>
          <span class="chip ${c.triple?'active':'inactive'}">Triple Captain ${c.triple?'✅':'❌'}</span>
          <span class="chip ${c.freehit?'active':'inactive'}">Free Hit ${c.freehit?'✅':'❌'}</span>
        </div>
      </div>`;
    }).join("");
    

    // رأس الجدول
    const ths = ['<th class="round-col">الجولة</th>']
      .concat(players.map(p=>`<th>${p}</th>`)).join("");
    head.innerHTML = `<tr>${ths}</tr>`;

    // جسم الجدول
    let rows="";
    for(let r=1;r<=ROUNDS;r++){
      const cells = players.map((p,i)=>`<td id="cell-r${r}-p${i}">0</td>`).join("");
      rows += `<tr><th class="round-col">#${r}</th>${cells}</tr>`;
    }
    body.innerHTML = rows;

    // تذييل
    const final = players.map((_,i)=>`<td id="col-sum-${i}" style="font-weight:800">0</td>`).join("");
    foot.innerHTML = `<tr><th class="round-col">الإجمالي</th>${final}</tr>`;

    updateAll();
  }

  function updateRoundRanking(roundNumber){
    const roundTotals = players.map((name,idx)=>({name,score:data[roundNumber-1]?.[idx]||0}))
                               .sort((a,b)=>b.score-a.score);
    roundRankingEl.innerHTML = roundTotals.map((r,i)=>`
      <li><span>${i+1}. ${r.name}</span><span class="muted">${r.score}</span></li>`).join("");
  }

  function updateAll(){
    const totals = Array(players.length).fill(0);
    let lastRoundWithData=1;

    for(let r=1;r<=ROUNDS;r++){
      let hasData=false;
      for(let p=0;p<players.length;p++){
        const v = data[r-1]?.[p]||0;
        totals[p]+=v;
        if(v>0) hasData=true;
        el(`#cell-r${r}-p${p}`).textContent=v;
      }
      if(hasData) lastRoundWithData=r;
    }

    for(let p=0;p<players.length;p++){
      el(`#total-${players[p]}`).textContent=totals[p];
      el(`#col-sum-${p}`).textContent=totals[p];
    }

    // ترتيب المجموع
    const rankData = players.map((n,i)=>({name:n,score:totals[i]})).sort((a,b)=>b.score-a.score);
    ranking.innerHTML = rankData.map((r,i)=>`
      <li><span>${i+1}. ${r.name}</span><span class="muted">${r.score}</span></li>`).join("");

    updateRoundRanking(lastRoundWithData);
  }

  function exportCSV(){
    const header=["Round"].concat(players);
    const lines=[header.join(",")];
    for(let r=1;r<=ROUNDS;r++){
      const row=data[r-1]||Array(players.length).fill(0);
      lines.push([`#${r}`].concat(row).join(","));
    }
    const totals=players.map((_,i)=>+el(`#col-sum-${i}`).textContent||0);
    lines.push(["TOTAL"].concat(totals).join(","));
    const blob=new Blob([lines.join("\n")],{type:"text/csv;charset=utf-8"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");a.href=url;a.download="scores_38_rounds.csv";
    document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
  }

  el("#exportCsv").addEventListener("click",exportCSV);
  buildUI();
})();
</script>
</body>
</html>

